/*
 * Template7 0.9.8
 * Mobile-first JavaScript template engine
 *
 * http://www.idangero.us/framework7/docs/template7.html
 *
 * Copyright 2014, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under MIT
 *
 * Released on: August 24, 2014
*/
window.Template7=function(){"use strict";function a(a){return"[object Array]"===Object.prototype.toString.apply(a)}function b(a){return a instanceof Object}function c(a){return"function"==typeof a}function d(a){var b,c,d=[];if(!a)return[];var e=a.split(/({{[^{^}]*}})/);for(b=0;b<e.length;b++){var f=e[b];if(""!==f)if(f.indexOf("{{")<0)d.push({type:"plain",content:f});else{if(f.indexOf("{/")>=0)continue;if(f.indexOf("{#")<0&&f.indexOf(" ")<0&&f.indexOf("else")<0){d.push({type:"variable",contextName:f.replace(/[{}]/g,"")});continue}var g=f.replace(/[{}#}]/g,"").split(" "),h=g[0],i=g[1],j={};if(g.length>2)for(var k,l=new RegExp(/\b(\w+)=["']([^"']+)(?=["'])/g);null!==(k=l.exec(f));)j[k[1]]="false"===k[2]?!1:k[2];if(f.indexOf("{#")>=0){var m,n="",o="",p=0,q=!1,r=!1,s=0;for(c=b+1;c<e.length;c++)if(e[c].indexOf("{{#")>=0&&s++,e[c].indexOf("{{/")>=0&&s--,e[c].indexOf("{{#"+h)>=0)n+=e[c],r&&(o+=e[c]),p++;else if(e[c].indexOf("{{/"+h)>=0){if(!(p>0)){m=c,q=!0;break}p--,n+=e[c],r&&(o+=e[c])}else e[c].indexOf("else")>=0&&0===s?r=!0:(r||(n+=e[c]),r&&(o+=e[c]));q&&(m&&(b=m),d.push({type:"helper",helperName:h,contextName:i,content:n,inverseContent:o,hash:j}))}else f.indexOf(" ")>0&&d.push({type:"helper",helperName:h,contextName:i,hash:j})}}return d}var e={},f=function(c,f){function g(a,c,d){if("this"===a||"undefined"==typeof a)return c;if(a.indexOf("@")>=0){var e=a.replace(/[@ ]/g,"");if(d&&"undefined"!=typeof d[e])return d[e]}if(a.indexOf(".")>0&&a.indexOf("../")<0){for(var f=a.split("."),g=c,h=0;h<f.length;h++)g="this"===f[h]?c:"undefined"!=typeof g&&b(c)&&f[h]in g?g[f[h]]:void 0;c=g}else a.indexOf("../")>=0||(c=c[a]?c[a]:void 0);return c}function h(a,b){return{fn:function(b,c){return i(a.content,b,c)},inverse:function(b,c){return a.inverseContent?i(a.inverseContent,b,c):""},hash:a.hash||{},helpers:n.helpers,data:b}}function i(c,e,f){if(c=c||n.template,"string"!=typeof c)throw new Error("Template7: Template must be a string");var j,k,l=e||n.context,m=d(c),o="";for(j=0;j<m.length;j++){var p=m[j];if("plain"!==p.type){if("variable"===p.type&&(k=g(p.contextName,l,f),"undefined"!=typeof k&&(o+=k.toString())),"helper"===p.type){k=g(p.contextName,l,f);var q,r=h(p,f),s=p.helperName;if(p.helperName in n.helpers)q=n.helpers[s].call(l,k,r);else{if(p.contextName||!("this"===s||b(k)&&s in k))throw new Error('Template7: Missing helper: "'+s+'"');var t="this"===s?k:k[s];q=a(t)?n.helpers.each.call(l,k[s],r):i(p.content,k[s])}"undefined"!=typeof q&&(o+=q.toString())}}else o+=p.content}return o}function j(a){return a.content?m(a.content):function(){return""}}function k(a){return a.inverseContent?m(a.inverseContent):function(){return""}}function l(a){var b="this"===a?"ctx":"ctx."+a;return a&&a.indexOf("@")>=0&&(b="(data && data."+a.replace("@","")+")"),b}function m(a){if(a=a||n.template,"string"!=typeof a)throw new Error("Template7: Template must be a string");var b=d(a);if(0===b.length)return function(){return""};var c="(function (ctx, data) {\n";0===o&&(c+='function c(val) {if (typeof val !== "undefined") return val; else return ""}\n',c+="function isArray(arr){return Object.prototype.toString.apply(arr) === '[object Array]';}\n"),o++,c+="var ret = '';\n";var e;for(e=0;e<b.length;e++){var f=b[e];if("plain"!==f.type){var g;if("variable"===f.type&&(g=l(f.contextName),c+="ret += c("+g+");"),"helper"===f.type)if(f.helperName in n.helpers)g=l(f.contextName),c+="ret += (Template7.helpers."+f.helperName+").call(ctx, "+g+", {hash:"+JSON.stringify(f.hash)+", data: data || {}, fn: "+j(f)+", inverse: "+k(f)+"});";else{if(f.contextName)throw new Error('Template7: Missing helper: "'+f.helperName+'"');g=l(f.helperName),c+="if ("+g+") {",c+="if (isArray("+g+")) {",c+="ret += (Template7.helpers.each).call(ctx, "+g+", {hash:"+JSON.stringify(f.hash)+", data: data || {}, fn: "+j(f)+", inverse: "+k(f)+"});",c+="}else {",c+="ret += (Template7.helpers.with).call(ctx, "+g+", {hash:"+JSON.stringify(f.hash)+", data: data || {}, fn: "+j(f)+", inverse: "+k(f)+"});",c+="}}"}}else c+="ret +='"+f.content.replace(/\n/g,"\\n").replace(/'/g,"\\'")+"';"}return c+="\nreturn ret;})",eval.call(window,c)}var n=this;n.template=c,n.context=f;var o=0;n.compile=function(a){return n.compiled||(n.compiled=m(a)),n.compiled},n.render=function(a){n.context=a,n.prevContext=void 0;var b,c,d;if(n.options.cache){for(var f in e)f.indexOf("template_")>=0&&e[f]===n.template&&(d=f.split("template_")[1],e["data_"+d]===JSON.stringify(a)&&(c=e["rendered_"+d]));if(c)return c}return b=i(n.template,a),n.options.cache&&(d=(new Date).getTime(),e["template_"+d]=n.template,e["data_"+d]=JSON.stringify(a),e["rendered_"+d]=b),b}};f.prototype={options:{cache:!1},helpers:{"if":function(a,b){return c(a)&&(a=a.call(this)),a?b.fn(this,b.data):b.inverse(this,b.data)},unless:function(a,b){return c(a)&&(a=a.call(this)),a?b.inverse(this,b.data):b.fn(this,b.data)},each:function(b,d){var e="",f=0;if(c(b)&&(b=b.call(this)),a(b))for(d.hash.reverse&&!b.t7Reversed&&(b=b.reverse(),b.t7Reversed=!0),!d.hash.reverse&&b.t7Reversed&&(b=b.reverse(),b.t7Reversed=!1),f=0;f<b.length;f++)e+=d.fn(b[f],{first:0===f,last:f===b.length-1,index:f});else for(var g in b)f++,e+=d.fn(b[g],{key:g});return f>0?e:d.inverse(this)},"with":function(a,b){return c(a)&&(a=a.call(this)),b.fn(a)},join:function(a,b){return c(a)&&(a=a.call(this)),a.join(b.hash.delimeter)}}};var g=function(a,b){if(2===arguments.length){var c=new f(a),d=c.render(b);return c=null,d}return new f(a)};return g.registerHelper=function(a,b){f.prototype.helpers[a]=b},g.render=function(a,b){g(a,b)},g.compile=function(a){var b=new f(a);return b.compile()},g.cache=e,g.clearCache=function(a){if(0===arguments.length)return void(e={});var b,c;for(b in e){{var d="string"==typeof a?"template_":"data_";"string"==typeof a?a:JSON.strigify(a)}b.indexOf(d)>=0&&e[b]===a&&(c=b.split("_")[1])}c&&(delete e["template_"+c],delete e["data_"+c],delete e["rendered_"+c])},g.options=f.prototype.options,g.helpers=f.prototype.helpers,g}();